<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>노원구 스타벅스 지도</title>
  <!-- Leaflet core -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <!-- MarkerCluster (optional, helps when many pins overlap) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }
    .map-title {
      position: absolute; z-index: 1000; left: 12px; top: 12px;
      background: rgba(255,255,255,0.9); backdrop-filter: saturate(1.2) blur(2px);
      border-radius: 12px; padding: 10px 12px; box-shadow: 0 2px 10px rgba(0,0,0,.08);
      font-size: 14px; line-height: 1.2; color: #111; font-weight: 600;
    }
    .leaflet-popup-content b { font-size: 14px; }
    .leaflet-popup-content small { color:#555; }
    @media (prefers-color-scheme: dark) {
      .map-title { background: rgba(32,32,32,0.85); color: #e8e8e8; }
    }
  </style>
</head>
<body>
  <!--
    사용법
    1) 이 파일을 그대로 GitHub에 업로드(GitHub Pages)하면 작동합니다.
    2) 아래 const DATA에 당신의 JSON을 붙여넣어 갱신할 수 있습니다.
       스키마: { stores: [{ name, address, lat, lng }] }
  -->

  <div id="map"></div>
  <div class="map-title">노원구 스타벅스 지도</div>

  <script>
  // === ① 여기에 제공하신 JSON 데이터를 그대로 넣었습니다 ===
  const DATA = {
    "stores": [
      {"name":"노원구청","address":"서울특별시 노원구 노해로 447 (상계동)","lat":37.6539896,"lng":127.057755},
      {"name":"노원상계","address":"서울특별시 노원구 동일로215길 2 (상계동)","lat":37.651535,"lng":127.061026},
      {"name":"태릉입구역DT","address":"서울특별시 노원구 화랑로 469 (공릉동)","lat":37.61942,"lng":127.07932},
      {"name":"월계이마트","address":"서울특별시 노원구 마들로3길 15 (월계동)","lat":37.627149177269075,"lng":127.06210118175261},
      {"name":"노원역","address":"서울특별시 노원구 동일로 1413 (상계동) 1층","lat":37.654751,"lng":127.060034},
      {"name":"중계역","address":"서울특별시 노원구 동일로 1339, 대한빌딩 (상계동)","lat":37.64817,"lng":127.062244},
      {"name":"광운대","address":"서울특별시 노원구 석계로 104 (월계동)","lat":37.62317424708698,"lng":127.06080652927419},
      {"name":"노원KT","address":"서울특별시 노원구 노해로 502, (주)KT 노원사옥 (상계동)","lat":37.654562,"lng":127.063617},
      {"name":"은행사거리","address":"서울특별시 노원구 중계로 217, 중흥빌딩 103,203호 (중계동)","lat":37.6505261052442,"lng":127.07599353308129},
      {"name":"공릉역","address":"서울특별시 노원구 동일로 1081 (공릉동)","lat":37.626337,"lng":127.072252},
      {"name":"노원마들역","address":"서울특별시 노원구 노원로 569 (상계동, 임광아파트)","lat":37.6610890700127,"lng":127.05801543641189},
      {"name":"공릉DT","address":"서울특별시 노원구 동일로 1015 (공릉동)","lat":37.6206884,"lng":127.0743116},
      {"name":"상계초교사거리","address":"서울특별시 노원구 노원로 449 (상계동)","lat":37.656776,"lng":127.066442},
      {"name":"월계트레이더스","address":"서울특별시 노원구 마들로3길 17 (월계동)","lat":37.62758407402858,"lng":127.06177585602872},
      {"name":"월계역","address":"서울특별시 노원구 초안산로2라길26 월계동(104,105,106호)","lat":37.6295,"lng":127.0574}
    ]
  };

  // === ② 지도 기본 설정 ===
  const map = L.map('map', {
    center: [37.654, 127.060],
    zoom: 13,
    scrollWheelZoom: true
  });

  // OpenStreetMap 타일
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);

  // === ③ 마커 추가 (클러스터 적용) ===
  const markers = L.markerClusterGroup({ showCoverageOnHover: false, spiderfyOnMaxZoom: true });
  const bounds = [];

  DATA.stores.forEach((s) => {
    if (!Number.isFinite(s.lat) || !Number.isFinite(s.lng)) return;

    const gmaps = `https://www.google.com/maps?q=${s.lat},${s.lng}`;
    const popupHtml = `
      <div>
        <b>${escapeHtml(s.name)}</b><br/>
        <small>${escapeHtml(s.address || '')}</small><br/>
        <a href="${gmaps}" target="_blank" rel="noopener">구글지도 열기</a>
      </div>`;

    const m = L.marker([s.lat, s.lng]).bindPopup(popupHtml);
    markers.addLayer(m);
    bounds.push([s.lat, s.lng]);
  });

  map.addLayer(markers);
  if (bounds.length) map.fitBounds(bounds, { padding: [24, 24] });

  // === ④ 유틸: XSS 방지용 이스케이프 ===
  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, (ch) => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'
    })[ch]);
  }
  </script>
</body>
</html>
